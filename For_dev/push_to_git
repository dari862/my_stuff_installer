#!/bin/sh

# Function to push the current repository
push_now() {
    repo_name="$1"
    git remote set-url origin "git@github.com:dari862/${repo_name}.git"
    git add -A

    if git diff --cached --quiet; then
        echo "No changes to commit for ${repo_name}."
    else
        if git commit -m "Update README.md"; then
            echo "Committed changes in ${repo_name}."
        else
            echo "Failed to commit changes in ${repo_name}."
        fi
    fi

    if ! git push --set-upstream origin main; then
        echo "Push failed, attempting force push for ${repo_name}."
        git push --force
    fi
}

# List of repositories
repos="
my_stuff
Theme_Stuff
my_stuff_installer
YadAppsStore
"

# Start SSH agent and add key
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_rsa

# Loop through each repo
for repo in ${repos}; do
    repo_path="$HOME/Desktop/$repo"
    if [ -d "$repo_path" ]; then
        cd "$repo_path" || { echo "Failed to cd into $repo_path"; continue; }
        echo "###############################################"
        echo "#  Pushing repository: $repo"
        echo "###############################################"
        push_now "$repo"
    else
        echo "Directory not found: $repo_path"
    fi
done
