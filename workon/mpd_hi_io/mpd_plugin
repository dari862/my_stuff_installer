cd /tmp
wget https://www.musicpd.org/download/mpd/0.24/mpd-0.24.6.tar.xz
tar xf mpd-0.24.6.tar.xz
rm mpd-0.24.6.tar.xz
cd mpd-0.24.6

apt install -y meson g++ pkgconf \
  libfmt-dev \
  libpcre2-dev \
  libmad0-dev libmpg123-dev libid3tag0-dev \
  libflac-dev libvorbis-dev libopus-dev libogg-dev \
  libadplug-dev libaudiofile-dev libsndfile1-dev libfaad-dev \
  libfluidsynth-dev libgme-dev libmikmod-dev libmodplug-dev \
  libmpcdec-dev libwavpack-dev libwildmidi-dev \
  libsidplay2-dev libsidutils-dev libresid-builder-dev \
  libavcodec-dev libavformat-dev \
  libmp3lame-dev libtwolame-dev libshine-dev \
  libsamplerate0-dev libsoxr-dev \
  libbz2-dev libcdio-paranoia-dev libiso9660-dev libmms-dev \
  libzzip-dev \
  libcurl4-gnutls-dev libexpat1-dev \
  nlohmann-json3-dev \
  libasound2-dev libao-dev libjack-jackd2-dev libopenal-dev \
  libpulse-dev libshout3-dev \
  libsndio-dev \
  libmpdclient-dev \
  libnfs-dev \
  libupnp-dev \
  libavahi-client-dev \
  libsqlite3-dev \
  libsystemd-dev \
  libgtest-dev \
  libicu-dev \
  libchromaprint-dev \
  libgcrypt20-dev \
  libsystemd-dev \
  libpipewire-0.3-dev
  
apt install -y libavfilter-dev libopenmpt-dev wildmidi libsidplayfp-dev python3-sphinx cmake

mkdir -p /usr/local/lib/pkgconfig
cat << EOF >/usr/local/lib/pkgconfig/wildmidi.pc
prefix=/usr
exec_prefix=${prefix}
libdir=${exec_prefix}/lib/x86_64-linux-gnu
includedir=${prefix}/include

Name: WildMidi
Description: WildMidi software MIDI library
Version: 0.4.3
Libs: -L${libdir} -lWildMidi
Cflags: -I${includedir}
EOF

export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH

sed -i '/if systemd_dep.found()/,/endif/c\
ddddddddddddddddddddddddddddddddddddddddddddddddd
' meson.build

sed -i "s/ddddddddddddddddddddddddddddddddddddddddddddddddd/systemd_dep = dependency('libsystemd', required: true)/g" meson.build

ln -s /usr/lib/x86_64-linux-gnu/pkgconfig/libsystemd.pc /usr/lib/x86_64-linux-gnu/pkgconfig/systemd.pc

meson setup . output/release --buildtype=debugoptimized -Db_ndebug=true
ninja -C output/release

case hi io
===========
liburing-dev
